import 'package:camera/camera.dart';
import 'package:flutter/material.dart';
import 'package:google_mlkit_pose_detection/google_mlkit_pose_detection.dart';

class PosePainter extends CustomPainter {
  PosePainter(this.absoluteImageSize, this.poses, this.camDire2);

  final Size absoluteImageSize;
  final List<Pose> poses;
  CameraLensDirection camDire2;
  @override
  void paint(Canvas canvas, Size size) {
    final double scaleX = size.width / absoluteImageSize.width;
    final double scaleY = size.height / absoluteImageSize.height;

    final paint = Paint()
      ..style = PaintingStyle.stroke
      ..strokeWidth = 4.0
      ..color = Colors.green;

    final leftPaint = Paint()
      ..style = PaintingStyle.stroke
      ..strokeWidth = 3.0
      ..color = Colors.yellow;

    final rightPaint = Paint()
      ..style = PaintingStyle.stroke
      ..strokeWidth = 3.0
      ..color = Colors.blueAccent;

    for (final pose in poses) {
      pose.landmarks.forEach((_, landmark) {
        Offset pointCamBack = Offset(landmark.x * scaleX, landmark.y * scaleY);
        Offset pointCamFront =
            Offset(size.width - landmark.x * scaleX, landmark.y * scaleY);

        if (camDire2 == CameraLensDirection.back) {
          canvas.drawCircle(pointCamBack, 1, paint);
        } else {
          canvas.drawCircle(pointCamFront, 1, paint);
        }

        // canvas.drawCircle(
        //     Offset(landmark.x * scaleX, landmark.y * scaleY), 1, paint);
      });

      void paintLine(
          PoseLandmarkType type1, PoseLandmarkType type2, Paint paintType) {
        final PoseLandmark joint1 = pose.landmarks[type1]!;
        final PoseLandmark joint2 = pose.landmarks[type2]!;

        Offset point1WhenCamBack = Offset(joint1.x * scaleX, joint1.y * scaleY);
        Offset point2WhenCamBack = Offset(joint2.x * scaleX, joint2.y * scaleY);

        Offset point1WhenCamFront =
            Offset(size.width - joint1.x * scaleX, joint1.y * scaleY);
        Offset point2WhenCamFront =
            Offset(size.width - joint2.x * scaleX, joint2.y * scaleY);

        // canvas.drawLine(Offset(joint1.x * scaleX, joint1.y * scaleY),
        //     Offset(joint2.x * scaleX, joint2.y * scaleY), paintType);

        Offset point1 = camDire2 == CameraLensDirection.front
            ? point1WhenCamFront
            : point1WhenCamBack;
        Offset point2 = camDire2 == CameraLensDirection.front
            ? point2WhenCamFront
            : point2WhenCamBack;

        canvas.drawLine(point1, point2, paintType);
      }

      //Draw arms
      // paintLine(
      //     PoseLandmarkType.leftShoulder, PoseLandmarkType.leftElbow, leftPaint);
      // paintLine(
      //     PoseLandmarkType.leftElbow, PoseLandmarkType.leftWrist, leftPaint);
      // paintLine(PoseLandmarkType.rightShoulder, PoseLandmarkType.rightElbow,
      //     rightPaint);
      // paintLine(
      //     PoseLandmarkType.rightElbow, PoseLandmarkType.rightWrist, rightPaint);

      //Draw Body coluna ombro
      paintLine(
          PoseLandmarkType.leftShoulder, PoseLandmarkType.leftHip, leftPaint);
      paintLine(PoseLandmarkType.rightShoulder, PoseLandmarkType.rightHip,
          rightPaint);

      //Draw legs
      // paintLine(PoseLandmarkType.leftHip, PoseLandmarkType.leftKnee, leftPaint);
      // paintLine(
      //     PoseLandmarkType.leftKnee, PoseLandmarkType.leftAnkle, leftPaint);
      // paintLine(
      //     PoseLandmarkType.rightHip, PoseLandmarkType.rightKnee, rightPaint);
      // paintLine(
      //     PoseLandmarkType.rightKnee, PoseLandmarkType.rightAnkle, rightPaint);

      // paintLine(
      //     PoseLandmarkType.leftWrist, PoseLandmarkType.leftThumb, leftPaint);

      // paintLine(
      //     PoseLandmarkType.leftWrist, PoseLandmarkType.leftPinky, leftPaint);

      // paintLine(
      //     PoseLandmarkType.leftWrist, PoseLandmarkType.leftIndex, leftPaint);

      // Draw pulso
      // paintLine(
      //     PoseLandmarkType.rightWrist, PoseLandmarkType.rightThumb, rightPaint);

      // paintLine(
      //     PoseLandmarkType.rightWrist, PoseLandmarkType.rightPinky, rightPaint);

      // paintLine(
      //     PoseLandmarkType.rightWrist, PoseLandmarkType.rightIndex, rightPaint);
    }
  }

  @override
  bool shouldRepaint(PosePainter oldDelegate) {
    return oldDelegate.absoluteImageSize != absoluteImageSize ||
        oldDelegate.poses != poses;
  }
}
